# Декомпозиция первого набора требований

### 1. Начальная подготовка проекта к работе - 50 мин

1.1 Прочитать требования - 20 мин

1.2 Создать репозиторий на git - 10 мин

1.3 Создать “Хелловорлд” - 20 мин(R1.8)

### 2. Описываем тестовые данные - 12 мин

#### 2.1 Описываем пользователей - 5 мин(R1.1)

| login | password |
|-------|----------|
| vasya | 123 | 
| admin | admin  |
| q  | ?!# | 
| abcdefghij | qwerty

#### 2.2 Описываем ресурсы - 7 мин(R1.3)

| resourсe | role | user |
|---------|------|------|
|A | READ | vasya |
| A.B.C | WRITE | vasya | 
| A | EXECUTE | admin |
| A | READ | admin |
| A | WRITE | admin |  
| A | READ | admin | 
| A | EXECUTE | q |
| A | EXECUTE | vasya |

### 3. Записываем тесты в bat/sh файл(R1.12)

#### 3.1 Вывод справки - 3 мин

3.1.1 Команда: `app.jar`  
Ожидаемый результат: `exitCode 1` + вывод справки

3.1.2 Команда: `app.jar -h`  
Ожидаемый результат: `exitCode 1` + вывод справки

3.1.3 Команда: `app.jar -q`  
Ожидаемый результат: `exitCode 0` + вывод справки(особенности реализации)

#### 3.2 Аутентификация - 6 мин(R1.11)

3.2.1 `app.jar -log: vasya -pass:123`  
Ожидаемый результат:  `exitCode 0` успех

3.2.2 `app.jar -pass:123 -log: vasya`  
Ожидаемый результат: `exitCode 0` успех

3.2.3 `app.jar -log: VASYA -pass:123`  
Ожидаемый результат: `exitCode 2` неверный формат логина

3.2.4 `app.jar -log: asd -pass:123`  
Ожидаемый результат: `exitCode 3` неизвестный логин

3.2.5 `app.jar -log: admin -pass:1234`  
Ожидаемый результат: `exitCode 4` неверный пароль

3.2.6 `app.jar -log: admin -pass:admin `  
Ожидаемый результат:  `exitCode 0` успех

### 3.3 Авторизация - 10 мин(R1.11)

3.3.1 `app.jar -log: vasya -pass:123 -role READ -res A`  
Ожидаемый результат:  `exitCode 0` успех

3.3.2 `app.jar -log: vasya -pass:123 -role DELETE -res A`  
Ожидаемый результат:  `exitCode 5` неизвестная роль

3.3.3 `app.jar -log: vasya -pass:123 -role WRITE -res A`  
Ожидаемый результат:  `exitCode 6` нет доступа

3.3.4 `app.jar -log: vasya -pass:123 -role READ -res A.B`  
Ожидаемый результат:  `exitCode 0` успех

3.3.5 `app.jar -log: admin -pass:admin -role WRITE -res A.B.C`  
Ожидаемый результат:  `exitCode 0` успех

3.3.6 `app.jar -log: vasya -pass:1234 -role DELETE -res A `  
Ожидаемый результат:  `exitCode 4` неверный пароль

3.3.7 `app.jar -log: vasya -pass:123 -role WRITE -res a.b.c `  
Ожидаемый результат:  `exitCode 6` нет доступа

3.3.8 `app.jar -log: admin -pass:admin -role READ -res`   
Ожидаемый результат:  `exitCode 0` условная аутентиф

3.3.9 `app.jar -log: admin -pass:admin -role EXECUTE -res A`  
Ожидаемый результат: `exitCode 6` выше по дереву

3.3.10 `app.jar -log: admin -pass:admin -role WRITE -res A.A`  
Ожидаемый результат:  `exitCode 6` брат

### 3.4 Аккаунтинг - 14 мин(R1.11)

3.4.1 `app.jar -log: vasya -pass:123 -role READ -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 0` успех

3.4.2 `app.jar -log: vasya -pass:1234 -role READ -res A -ds 2017.01.07 -de 2017.02.12 -vol 100 `  
Ожидаемый результат:  `exitCode 4` неверный пароль

3.4.3 a`pp.jar -log: admin -pass:admin -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol qewqeqw`  
Ожидаемый результат:  `exitCode 7` некорректная активность(объем)

3.4.4 `app.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.07 -de 2017.01.02 -vol 234 `  
Ожидаемый результат:  `exitCode 7` некорректная активность(дата)

3.4.5 `app.jar -log: admin -pass:admin -role READ -res A -ds 432134 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 7` некорректная активность(невалидная дата)

3.4.6 `app.jar -log: vasya -pass:123 -role READ -res A`  
Ожидаемый результат:  `exitCode 0` условная авторизация

3.4.7 `app.jar -log: q -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 4` неверный пароль

3.4.8 `app.jar -log: qwqe -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.01.07 -vol 100`  
Ожидаемый результат:  `exitCode 3` неизвестный логин

3.4.9 `app.jar -log: USER -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат: `exitCode 2` неверный формат логина

3.4.10 `app.jar -log: admin -pass:admin -role DELETE -res A -ds 2017.01.07 -de 2017.02.12 -vol wqeq`  
Ожидаемый результат:  `exitCode 5` неизвестная роль

3.4.11 `app.jar -log: vasya -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 6` нет доступа

3.4.12 a`pp.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.02 -de 12162 -vol 234`
Ожидаемый результат:  `exitCode 7` некорректная активность(дата) - проверка второго значения

3.4.13 `app.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.02 -vol 234`  
Ожидаемый результат:  `exitCode 7` некорректная активность(дата) - отсутствие второго значения

3.4.14 `app.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.02 -vol`  
Ожидаемый результат:  `exitCode 7` некорректная активность(объем) - отсутствие значения объема

### 4. Сценарии простые - 22 мин(R1.9)

4.1 Проверяем наличие аргументов - 5 мин

4.2 Создаем функцию вывода справки(`System.exit(1)`) - 7 мин

4.3 Проверяем надо ли выводить справку `args[0] = “-h”` - 5 мин

4.4 Во всех остальных случаях выводим справку и возвращаем `0` - 5мин

### 5. Сценарии аутентификации - 47 мин

5.1 Создаем enum с exit-кодами: - 10 мин(R1.9)
| exit code | comment |
|-----------|---------|
| `0` | успех | 
| `1` | справка |
| `2` | неверный формат логина |
| `3` | неизвестный логин |
| `4` | неверный пароль |

5.2 Создаем метод надо ли аутентифицировать (`args[0] == “-login” && args[2] == “-pass”`) - 10 мин(R.11)

5.3 Создаем метод `validateLogin(login)`, который проверяет правильность формата логина, используя регулярку - 20 мин(R1.1)

5.4 Создаем метод логин существует (делаем тесты что `login == vasya`) - 7 мин

5.5 Создаем метод проверки пароля (делаем тесты что `login == vasya pass == 123`) - 7 мин(R1.1)

### 6 Создание доменной модели - 1 час 22 мин

6.1 Создаем класс(`data class`) `User`( поля `login`, `pass`) - 7 мин

6.2 Создаем коллекцию для хранения юзеров и добавляем туда тестовые данные - 15 мин

6.3 Исправляем методы на работу с коллекцией юзеров - 15 мин

6.4 Создаем класс(`data class`) `ArgHandler` (поля `h`, `login`, `pass`) конструктор которого на вход получит массив параметров командной строки и распарсит их - 15 мин(R1.8)

6.5 В классе `ArgHandler` создаем три метода:
выводСправки(); есть ли аргументы(); нужна аутентификация(); - 20 мин

6.6 Проводим рефакторинг, чтобы использовать `ArgHandler` - 10 мин


### 7. Сценарии авторизации - 2 часа 10 мин

7.1 Создаем класс `Resources`(поля `id`, `path`) - 10 мин

7.2 Создаем `enum` для хранения ролей - 10 мин(R1.5)
| role |
|------|
|`WRITE` |
| `READ` |
| `EXECUTE` |

7.3 Создаем `List` для хранения ресурсов - 10 мин(R1.4)

7.4 Добавляем в `enum` c exit-кодами следующие коды: - 5 мин(R1.9)
| exit code | comment |
|-----------|---------|
| 5 | неизвестная роль |
| 6 | нет доступа |

7.5 Добавляем в класс `ArgHandler` поля `role`, `res` (роль ресурс) - 10 мин

7.6 Создаем метод в классе `ArgHandler` надо ли авторизовать (проверяем “распарсенные” данные, которые получены из массива параметров командной строки конструктора `ArgHandler`(`login`, `pass`, `role`, `res`)) - 15 мин

7.7 Создаем метод проверки существования роли(если роль не существует, выводить справку и exit-код `5`) - 20 мин

7.8 Создаем метод проверки доступа юзера к определенному ресурсу(если доступа нет то выводим справку и exit-код - `6`) - 20 мин

7.9 Создаем метод который будет разрешать доступ к потомкам ресурса, с такой же ролью как и у их родителя(проводим тесты на доступ к потомку ресурса с такой же ролью как у родителя) - 30 мин(R1.6)

### 8. Сценарии аккаунтинга - 1 час

8.1 Добавляем поля `ds` (дата начала сеанса), `de` (дата окончания сеанса), `vol`(объем) в класс `ArgHangler` - 5 мин(R1.7)

8.2 Добавляем опции аргументов командной строки(`ds` задание даты начала сеанса, `de` задание даты окончания сеанса, `vol` задание объема) - 10 мин

8.3 Добавляем проверку на комбинацию аргументов (логин, пароль, роль, путь, дата начала сеанса, дата окончания сеанса, объем) - 10 мин

8.4 Создаем метод проверки валидности даты( дата должна быть формата `YYYY-MM-DD`, иначе невалидна) - выводим exit-код `7` - 20 мин

8.5 Создаем методы проверки валидности объема( объем vol должен быть числом, иначе не валиден) - выводим exit-код `7` - 10 мин

8.6 Добавляем в enum c `exit`-кодами следующие коды: - 5 мин(R1.9)
| exit code | comment |
|-----------|---------|
|7 | некорректная активность |

8.7 Создаем метод надо ли аккаунтить( проверяем все ли данные переданы и правильно распаршены(`login`, `pass`, `role`, `res`, `ds`, `de`, `vol`) - 15 мин(R1.11))

### 9. Хеширование пароля - 1 час 25 мин(R1.2)

9.1 Добавить константу для хранения локального параметра хеширования - 5 мин

9.2 Добавить метод для декодирования пароля - 30 мин

9.3 Изменить дата класс `User` - добавить поля `hash` и `salt` - 5 мни

9.4 Обновить тестовые данные для `User` - 30 мин

9.5 Изменить метод, отвечающий за валидацию пароля - 15 мин

### 10. Добавляем и подключаем библиотеку kotlinx.cli -  45 мин(R1.10)

10.1 Изменяем класс `ArgHandler`, который обрабатывает входную строку, под использование kotlinx.cli - 30 мин

10.2 Проводим рефакторинг функции справки в соответствии с возможностями данной библиотеки - 15 мин


| Пункт | Оценка времени(мин) | Фактическое время(мин)|
| --- | --- | --- |
| 1  |  50  |  |
| 1.1 | 20 |  |
| 1.2 | 10 |  |
| 1.3 | 20 |  |
|  2  |  12 |  |
| 2.1 | 5 |  |
| 2.2 | 7 |  |
|  3  |  33 |  |
| 3.1 | 3 |  |
| 3.2 | 6 |  |
| 3.3 | 10 |  |
| 3.3 | 14 |  |
|  4  |  22 |  |
| 4.1 | 5 |  |
| 4.2 | 7 |  |
| 4.3 | 5 |  |
| 4.4 | 5 |  |
|  5  | 47 | |
| 5.1 | 10 |  |
| 5.2 | 10 |  |
| 5.3 | 20 |  |
| 5.4 | 7 |  |
| 5.5 | 7 |  |
|  6  |  82 | |
| 6.1 | 7 |  |
| 6.2 | 15 |  |
| 6.3 | 15 |  |
| 6.4 | 15 |  |
| 6.5 | 20 |  |
| 6.6 | 10 |  |
|  7  |  60 |  |
| 7.1 | 5 |  |
| 7.2 | 10 |  |
| 7.3 | 10 |  |
| 7.4 | 20 |  |
| 7.5 | 10 |  |
| 7.6 | 5 |  |
| 7.7 | 15 |  |
|  8  |  85 |  |
| 8.1 | 5 |  |
| 8.2 | 30 |  |
| 8.3 | 5 |  |
| 8.4 | 30 |  |
| 8.5 | 15 |  |
| 9 | 45 |  |
| 9.1 | 30 |  |
| 9.2 | 15 |  |
| Общее | 528 |  |
 